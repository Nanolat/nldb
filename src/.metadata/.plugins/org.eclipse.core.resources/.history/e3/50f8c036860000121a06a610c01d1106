//
 //   Weather update server in C++
 //   Binds PUB socket to tcp://*:5556
 //   Publishes random weather updates
 //
 //   Olivier Chamoux <olivier.chamoux@fr.thalesgroup.com>
 //
 #include <zmq.hpp>
 #include <stdio.h>
 #include <stdlib.h>
 #include <time.h>
 
int pubsub_publisher_main (int argc, char* argv[]) {
 
    //   Prepare our context and publisher
     zmq::context_t context (1);
     zmq::socket_t publisher (context, ZMQ_PUB);
     publisher.bind("tcp://*:5556");
//     publisher.bind("ipc://weather.ipc");
 
	printf("Starting to send weather updates...\n");

    //   Initialize random number generator
    for(int i=0; i< 3; i++ ) {
//   while (1) {
 
        int zipcode, temperature, relhumidity;
 
        //   Get values that will fool the boss
         zipcode      = 10001;
         temperature = 80;
         relhumidity = 10;
 
        //   Send message to all subscribers
         zmq::message_t message(20);
         _snprintf ((char *) message.data(), 20 ,
             "%05d %d %d", zipcode, temperature, relhumidity);
         publisher.send(message);

		printf("sent...\n");
    }
    return 0;
}
